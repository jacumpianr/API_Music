openapi: 3.0.3
info:
  title: Music_API
  version: "1.0.0"
  description: >
    API REST para gestionar artistas, álbumes y canciones.
    Incluye operaciones CRUD completas y subida de archivos.

servers:
  - url: http://localhost:3000

tags:
  - name: Artistas
    description: Gestión de cantantes y bandas
  - name: Albumes
    description: Gestión de discos y portadas
  - name: Canciones
    description: Gestión de pistas de audio

paths:
  # -------------------- ARTISTAS --------------------
  /artistas:
    get:
      summary: Obtener todos los artistas
      tags: [Artistas]
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            fetch("http://localhost:3000/artistas")
              .then(res => res.json())
              .then(console.log);
        - lang: Python
          label: Python (requests)
          source: |
            import requests
            print(requests.get("http://localhost:3000/artistas").json())
        - lang: cURL
          label: cURL
          source: curl -X GET http://localhost:3000/artistas
      responses:
        200:
          description: Lista de artistas
        500:
          description: Error interno del servidor

    post:
      summary: Crear un artista
      tags: [Artistas]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Nombre, Nacionalidad, FechaNacimientos]
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
                FechaNacimientos:
                  type: string
                  format: date
                Fotografia:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (multipart)
          source: |
            const fd = new FormData();
            fd.append("Nombre", "Alejandra Guzmán");
            fd.append("Nacionalidad", "México");
            fd.append("FechaNacimientos", "1968-02-09");
            fd.append("Fotografia", fileInput.files[0]);
            fetch("http://localhost:3000/artistas", { method: "POST", body: fd });
        - lang: Python
          label: Python (requests)
          source: |
            import requests
            data = {"Nombre": "Alejandra", "Nacionalidad": "MX", "FechaNacimientos": "1968-02-09"}
            files = {"Fotografia": open("foto.jpg", "rb")}
            requests.post("http://localhost:3000/artistas", data=data, files=files)
        - lang: cURL
          label: cURL
          source: |
            curl -X POST http://localhost:3000/artistas \
              -F "Nombre=Alejandra" -F "Nacionalidad=MX" \
              -F "FechaNacimientos=1968-02-09" -F "Fotografia=@foto.jpg"
      responses:
        201:
          description: Artista creado
        400:
          description: Datos inválidos

  /artistas/{id}:
    get:
      summary: Obtener un artista por ID
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Detalle del artista
        404:
          description: No encontrado

    put:
      summary: Actualizar un artista (Completo)
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
                Fotografia:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Nombre", "Nuevo Nombre");
            fetch("http://localhost:3000/artistas/1", { method: "PUT", body: fd });
        - lang: cURL
          label: cURL
          source: curl -X PUT http://localhost:3000/artistas/1 -F "Nombre=Nuevo"
      responses:
        200:
          description: Actualizado

    patch:
      summary: Actualizar parcialmente un artista
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              description: Enviar solo los campos a modificar
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
                Fotografia:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Nacionalidad", "USA"); // Solo cambio nacionalidad
            fetch("http://localhost:3000/artistas/1", { method: "PATCH", body: fd });
        - lang: Python
          label: Python
          source: |
            requests.patch("http://localhost:3000/artistas/1", data={"Nacionalidad": "USA"})
        - lang: cURL
          label: cURL
          source: curl -X PATCH http://localhost:3000/artistas/1 -F "Nacionalidad=USA"
      responses:
        200:
          description: Artista actualizado parcialmente

    delete:
      summary: Eliminar un artista
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Eliminado

  # -------------------- ALBUMES --------------------
  /albumes:
    get:
      summary: Obtener todos los álbumes
      tags: [Albumes]
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: fetch("http://localhost:3000/albumes").then(r => r.json());
        - lang: cURL
          label: cURL
          source: curl http://localhost:3000/albumes
      responses:
        200:
          description: Lista de álbumes

    post:
      summary: Crear un álbum
      tags: [Albumes]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Titulo, IdArtista]
              properties:
                Titulo:
                  type: string
                FechaLanzamiento:
                  type: string
                  format: date
                IdArtista:
                  type: integer
                Portada:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Titulo", "Dark Side of the Moon");
            fd.append("IdArtista", "1");
            fd.append("Portada", fileInput.files[0]);
            fetch("http://localhost:3000/albumes", { method: "POST", body: fd });
        - lang: Python
          label: Python
          source: |
            requests.post("http://localhost:3000/albumes", 
                          data={"Titulo": "Album X", "IdArtista": 1},
                          files={"Portada": open("cover.jpg", "rb")})
        - lang: cURL
          label: cURL
          source: |
            curl -X POST http://localhost:3000/albumes \
              -F "Titulo=Album X" -F "IdArtista=1" -F "Portada=@cover.jpg"
      responses:
        201:
          description: Álbum creado

  /albumes/{id}:
    get:
      summary: Obtener un álbum por ID
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Datos del álbum
        404:
          description: No encontrado

    put:
      summary: Actualizar un álbum (Completo)
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                FechaLanzamiento:
                  type: string
                  format: date
                IdArtista:
                  type: integer
                Portada:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Titulo", "Nuevo Titulo");
            fetch("http://localhost:3000/albumes/1", { method: "PUT", body: fd });
        - lang: cURL
          label: cURL
          source: curl -X PUT http://localhost:3000/albumes/1 -F "Titulo=Nuevo"
      responses:
        200:
          description: Actualizado

    patch:
      summary: Actualizar parcialmente un álbum
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                Portada:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Titulo", "Solo cambio el titulo");
            fetch("http://localhost:3000/albumes/1", { method: "PATCH", body: fd });
        - lang: cURL
          label: cURL
          source: curl -X PATCH http://localhost:3000/albumes/1 -F "Titulo=Solo titulo"
      responses:
        200:
          description: Actualizado parcialmente

    delete:
      summary: Eliminar un álbum
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Eliminado

  # -------------------- CANCIONES --------------------
  /canciones:
    get:
      summary: Obtener todas las canciones
      tags: [Canciones]
      x-codeSamples:
        - lang: JavaScript
          label: JS
          source: fetch("http://localhost:3000/canciones").then(r=>r.json());
        - lang: cURL
          label: cURL
          source: curl http://localhost:3000/canciones
      responses:
        200:
          description: Lista de canciones

    post:
      summary: Crear una canción (Subir audio)
      tags: [Canciones]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Titulo, IdAlbum, ArchivoAudio]
              properties:
                Titulo:
                  type: string
                Duracion:
                  type: string
                IdAlbum:
                  type: integer
                ArchivoAudio:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: |
            const fd = new FormData();
            fd.append("Titulo", "Bohemian Rhapsody");
            fd.append("IdAlbum", "5");
            fd.append("ArchivoAudio", fileInput.files[0]);
            fetch("http://localhost:3000/canciones", { method: "POST", body: fd });
        - lang: Python
          label: Python
          source: |
            requests.post("http://localhost:3000/canciones", 
                          data={"Titulo": "Song 1", "IdAlbum": 5},
                          files={"ArchivoAudio": open("song.mp3", "rb")})
        - lang: cURL
          label: cURL
          source: |
            curl -X POST http://localhost:3000/canciones \
             -F "Titulo=Song 1" -F "IdAlbum=5" -F "ArchivoAudio=@song.mp3"
      responses:
        201:
          description: Canción creada

  /canciones/{id}:
    get:
      summary: Obtener una canción por ID
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Detalles de la canción
        404:
          description: No encontrada

    put:
      summary: Actualizar una canción (Completo)
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                Duracion:
                  type: string
                IdAlbum:
                  type: integer
                ArchivoAudio:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS
          source: |
            // ...setup FormData...
            fetch("http://localhost:3000/canciones/1", { method: "PUT", body: fd });
        - lang: cURL
          label: cURL
          source: curl -X PUT http://localhost:3000/canciones/1 -F "Titulo=Remix"
      responses:
        200:
          description: Actualizada

    patch:
      summary: Actualizar parcialmente una canción
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                Duracion:
                  type: string
      x-codeSamples:
        - lang: JavaScript
          label: JS
          source: |
            const fd = new FormData();
            fd.append("Titulo", "Corrigiendo título");
            fetch("http://localhost:3000/canciones/1", { method: "PATCH", body: fd });
        - lang: cURL
          label: cURL
          source: curl -X PATCH http://localhost:3000/canciones/1 -F "Titulo=New"
      responses:
        200:
          description: Actualizada parcialmente

    delete:
      summary: Eliminar una canción
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        200:
          description: Eliminada

components:
  schemas:
    # --- Modelo de la Tabla Artistas ---
    Artista:
      type: object
      properties:
        id:
          type: integer
          description: ID único autogenerado
          example: 1
        Nombre:
          type: string
          description: Nombre artístico
          example: "Alejandra Guzmán"
        Nacionalidad:
          type: string
          example: "México"
        FechaNacimientos:
          type: string
          format: date
          example: "1968-02-09"
        Fotografia:
          type: string
          description: URL o ruta de la imagen almacenada
          example: "/uploads/artistas/foto_1.jpg"

    # --- Modelo de la Tabla Albumes ---
    Album:
      type: object
      properties:
        id:
          type: integer
          example: 10
        Titulo:
          type: string
          example: "Flor de Papel"
        FechaLanzamiento:
          type: string
          format: date
          example: "1991-10-15"
        Portada:
          type: string
          description: URL de la portada
          example: "/uploads/albumes/portada_10.jpg"
        IdArtista:
          type: integer
          description: Clave foránea (Relación con Artista)
          example: 1

    # --- Modelo de la Tabla Canciones ---
    Cancion:
      type: object
      properties:
        id:
          type: integer
          example: 45
        Titulo:
          type: string
          example: "Hacer el amor con otro"
        Duracion:
          type: string
          description: Duración en formato mm:ss o segundos
          example: "04:38"
        ArchivoAudio:
          type: string
          description: URL del archivo MP3
          example: "/uploads/canciones/audio_45.mp3"
        IdAlbum:
          type: integer
          description: Clave foránea (Relación con Album)
          example: 10