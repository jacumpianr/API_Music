openapi: 3.0.3
info:
  title: Music_API
  version: "1.0.0"
  description: >
    API REST para gestionar artistas, álbumes y canciones.
    
    Incluye documentación de errores comunes (400, 404, 500) y modelos de datos.
  contact:
    name: Soporte API

# -------------------------------------------------------------------------
# CONFIGURACIÓN ESPECIAL PARA REDOC (ESTO FUERZA EL MENÚ LATERAL)
# -------------------------------------------------------------------------
x-tagGroups:
  - name: General
    tags:
      - Artistas
      - Albumes
      - Canciones
  - name: Modelos de Datos
    tags:
      - Modelos

servers:
  - url: http://localhost:3000

tags:
  - name: Artistas
    description: Gestión de cantantes y bandas
  - name: Albumes
    description: Gestión de discos y portadas
  - name: Canciones
    description: Gestión de pistas de audio
  - name: Modelos
    description: Estructura de la base de datos (Schemas)

paths:
  # ==========================================
  #                 ARTISTAS
  # ==========================================
  /artistas:
    get:
      summary: Obtener todos los artistas
      tags: [Artistas]
      x-codeSamples:
        - lang: JavaScript
          label: JS (fetch)
          source: fetch("http://localhost:3000/artistas").then(r => r.json());
        - lang: cURL
          label: cURL
          source: curl -X GET http://localhost:3000/artistas
      responses:
        '200':
          description: Lista de artistas recuperada exitosamente
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Artista'
        '500':
          description: Error interno del servidor

    post:
      summary: Crear un artista
      tags: [Artistas]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Nombre, Nacionalidad, FechaNacimientos]
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
                FechaNacimientos:
                  type: string
                  format: date
                Fotografia:
                  type: string
                  format: binary
      x-codeSamples:
        - lang: JavaScript
          label: JS (FormData)
          source: |
            const fd = new FormData();
            fd.append("Nombre", "Alejandra");
            fd.append("Fotografia", fileInput.files[0]);
            fetch("http://localhost:3000/artistas", { method: "POST", body: fd });
      responses:
        '201':
          description: Artista creado correctamente
        '400':
          description: Datos inválidos (Faltan campos requeridos)
        '422':
          description: Error de validación (Formato de archivo incorrecto)

  /artistas/{id}:
    get:
      summary: Obtener un artista por ID
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalle del artista
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Artista'
        '404':
          description: Artista no encontrado
          content:
            application/json:
              example: { "error": "No existe un artista con ese ID" }

    put:
      summary: Actualizar un artista (Completo)
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
                Fotografia:
                  type: string
                  format: binary
      responses:
        '200':
          description: Artista actualizado
        '400':
          description: Datos inválidos
        '404':
          description: Artista no encontrado

    patch:
      summary: Actualizar parcialmente un artista
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Nombre:
                  type: string
                Nacionalidad:
                  type: string
      responses:
        '200':
          description: Actualizado parcialmente
        '404':
          description: Artista no encontrado

    delete:
      summary: Eliminar un artista
      tags: [Artistas]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Artista eliminado
        '404':
          description: Artista no encontrado

  # ==========================================
  #                 ALBUMES
  # ==========================================
  /albumes:
    get:
      summary: Obtener todos los álbumes
      tags: [Albumes]
      responses:
        '200':
          description: Lista de álbumes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Album'
        '500':
          description: Error interno del servidor

    post:
      summary: Crear un álbum
      tags: [Albumes]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Titulo, IdArtista]
              properties:
                Titulo:
                  type: string
                FechaLanzamiento:
                  type: string
                  format: date
                IdArtista:
                  type: integer
                Portada:
                  type: string
                  format: binary
      responses:
        '201':
          description: Álbum creado
        '400':
          description: Faltan datos obligatorios (Titulo o IdArtista)
        '404':
          description: El Artista referenciado no existe

  /albumes/{id}:
    get:
      summary: Obtener un álbum por ID
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalle del álbum
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Album'
        '404':
          description: Álbum no encontrado

    put:
      summary: Actualizar un álbum (Completo)
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                IdArtista:
                  type: integer
                Portada:
                  type: string
                  format: binary
      responses:
        '200':
          description: Actualizado correctamente
        '404':
          description: Álbum no encontrado

    patch:
      summary: Actualizar parcialmente un álbum
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
      responses:
        '200':
          description: Actualizado parcialmente
        '404':
          description: Álbum no encontrado

    delete:
      summary: Eliminar un álbum
      tags: [Albumes]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Eliminado correctamente
        '404':
          description: Álbum no encontrado

  # ==========================================
  #                 CANCIONES
  # ==========================================
  /canciones:
    get:
      summary: Obtener todas las canciones
      tags: [Canciones]
      responses:
        '200':
          description: Lista de canciones
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Cancion'
        '500':
          description: Error del servidor

    post:
      summary: Crear una canción (Subir audio)
      tags: [Canciones]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required: [Titulo, IdAlbum, ArchivoAudio]
              properties:
                Titulo:
                  type: string
                Duracion:
                  type: string
                IdAlbum:
                  type: integer
                ArchivoAudio:
                  type: string
                  format: binary
      responses:
        '201':
          description: Canción creada exitosamente
        '400':
          description: Datos inválidos o faltantes
        '422':
          description: Archivo de audio no soportado

  /canciones/{id}:
    get:
      summary: Obtener una canción por ID
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Detalles de la canción
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cancion'
        '404':
          description: Canción no encontrada

    put:
      summary: Actualizar una canción (Completo)
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
                IdAlbum:
                  type: integer
                ArchivoAudio:
                  type: string
                  format: binary
      responses:
        '200':
          description: Actualizada
        '404':
          description: Canción no encontrada

    patch:
      summary: Actualizar parcialmente una canción
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                Titulo:
                  type: string
      responses:
        '200':
          description: Actualizada parcialmente
        '404':
          description: Canción no encontrada

    delete:
      summary: Eliminar una canción
      tags: [Canciones]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Eliminada correctamente
        '404':
          description: Canción no encontrada

# ==========================================
#           MODELOS (SCHEMAS)
# ==========================================
components:
  schemas:
    Artista:
      type: object
      # x-tags ayuda a agruparlos si usas redocly
      x-tags: [Modelos] 
      properties:
        id:
          type: integer
          example: 1
        Nombre:
          type: string
          example: Alejandra Guzmán
        Nacionalidad:
          type: string
          example: México
        FechaNacimientos:
          type: string
          format: date
          example: '1968-02-09'

    Album:
      type: object
      x-tags: [Modelos]
      properties:
        id:
          type: integer
          example: 10
        Titulo:
          type: string
          example: Flor de Papel
        FechaLanzamiento:
          type: string
          format: date
          example: '1991-10-15'
        IdArtista:
          type: integer
          example: 1

    Cancion:
      type: object
      x-tags: [Modelos]
      properties:
        id:
          type: integer
          example: 45
        Titulo:
          type: string
          example: Hacer el amor con otro
        Duracion:
          type: string
          example: '04:38'
        Genero:
          type: string
          example: 'Rock Latino'
        IdAlbum:
          type: integer
          example: 10
        IdArtista:
          type: integer
          example: 2